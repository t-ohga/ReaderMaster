# 機能要件定義テンプレート

## メタ情報

| 項目 | 内容 |
|------|------|
| **ドキュメント名** | 機能要件定義書 v1 |
| **作成日** | YYYY-MM-DD |
| **最終更新日** | YYYY-MM-DD |
| **作成者** | [名前] |
| **承認者** | [名前] |
| **ステータス** | ドラフト / レビュー中 / 承認済み |

---

## 1. 機能要件の概要

### 1.1 目的
<!-- この機能要件定義の目的を記述 -->

- [ ] ビジョン（01_vision）の実現に向けた具体的機能の定義
- [ ] ユーザーニーズ（02_users）を満たす機能の明確化
- [ ] MVP（Minimum Viable Product）の特定と優先順位付け
- [ ] 開発スコープと実装順序の決定

### 1.2 参照ドキュメント
- **01_vision**: [ビジョンドキュメントへのパス]
- **02_users**: [ユーザー分析ドキュメントへのパス]

### 1.3 前提条件
<!-- 機能定義の前提となる条件 -->

**ビジョンからの前提**:
- コアバリュー: [01_visionから引用]
- 差別化要因: [01_visionから引用]

**ユーザーからの前提**:
- 主要ペルソナ: [02_usersから引用]
- Top 3ユースケース: [02_usersから引用]

---

## 2. コア機能（Core Functions）

### 2.1 ファイルアップロード機能

#### 2.1.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 2.1.2 詳細仕様

**対応ファイル形式**:
- [ ] PDF (.pdf)
- [ ] PNG (.png)
- [ ] JPEG/JPG (.jpg, .jpeg)
- [ ] その他: [必要に応じて追加]

**ファイル制約**:
- 最大ファイルサイズ: [例: 10MB]
- 同時アップロード数: [例: 5ファイル]
- ページ数制限（PDF）: [例: 50ページ]

**機能詳細**:
- [ ] ドラッグ&ドロップ対応
- [ ] ファイル選択ダイアログ
- [ ] アップロード進捗表示
- [ ] プレビュー機能
- [ ] エラーハンドリング

**成功基準**:
- [例: 10MB以下のファイルが5秒以内にアップロード完了]
- [例: プレビューが2秒以内に表示]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- 補足情報、制約事項など -->

---

### 2.2 AI/OCR抽出機能

#### 2.2.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 2.2.2 抽出パイプライン

**処理フロー**:
1. ファイル受信 → 前処理
2. AI/OCR処理 → オブジェクト認識
3. 分類・構造化 → 結果出力

**抽出対象**:
- [ ] テキスト（見出し、本文、キャプション）
- [ ] 表（罫線、セル、データ）
- [ ] 図形（矩形、円、線、矢印）
- [ ] 画像（埋め込み画像、ロゴ）
- [ ] その他: [必要に応じて追加]

**AI/OCRエンジン**:
- 使用技術: [例: Tesseract, Google Cloud Vision API, Claude Vision]
- 言語対応: [例: 日本語、英語]
- 精度目標: [例: テキスト認識精度 95%以上]

**オブジェクト分類ロジック**:
<!-- テキスト、表、図形の分類方法 -->
- テキスト判定基準: [例: 連続した文字列、フォント情報]
- 表判定基準: [例: 罫線の有無、セル構造]
- 図形判定基準: [例: ベクトル形状、境界線]

**成功基準**:
- [例: テキスト抽出精度 95%以上]
- [例: 表構造の正確な認識率 90%以上]
- [例: 処理時間：1ページあたり5秒以内]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- APIの選定理由、精度向上の戦略など -->

---

### 2.3 オブジェクト管理機能

#### 2.3.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 2.3.2 オブジェクトモデル

**オブジェクトタイプ**:
- **テキストオブジェクト**
  - プロパティ: [例: 内容、フォント、サイズ、位置、色]
  - 操作: [例: 編集、移動、削除]

- **表オブジェクト**
  - プロパティ: [例: 行数、列数、セルデータ、スタイル]
  - 操作: [例: セル編集、行列追加/削除、結合/分割]

- **図形オブジェクト**
  - プロパティ: [例: 形状タイプ、サイズ、色、線種]
  - 操作: [例: 変形、回転、スタイル変更]

**テーブル空間での配置**:
- [ ] 2Dキャンバス（無限スクロール）
- [ ] グリッドスナップ機能
- [ ] レイヤー管理（前面/背面）
- [ ] グループ化機能

**階層構造**:
- [ ] ページ単位の管理
- [ ] オブジェクトのグルーピング
- [ ] 親子関係の定義

**成功基準**:
- [例: 100個のオブジェクトを遅延なく配置可能]
- [例: オブジェクト選択の応答速度 < 100ms]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- データ構造、ストレージ方法など -->

---

## 3. 編集機能（Editing Functions）

### 3.1 テキスト編集機能

#### 3.1.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 3.1.2 編集操作

**基本編集**:
- [ ] インライン編集（ダブルクリック）
- [ ] テキスト選択・範囲指定
- [ ] コピー・カット・ペースト
- [ ] Undo/Redo

**フォーマット設定**:
- [ ] フォント変更（種類、サイズ）
- [ ] スタイル（太字、斜体、下線）
- [ ] 色変更（テキスト色、背景色）
- [ ] 配置（左揃え、中央、右揃え）

**高度な機能**:
- [ ] 検索・置換
- [ ] スペルチェック
- [ ] 言語対応（日本語、英語）

**成功基準**:
- [例: 編集操作の応答速度 < 50ms]
- [例: フォント変更がリアルタイムで反映]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- エディタライブラリの選定、リッチテキスト対応など -->

---

### 3.2 表編集機能

#### 3.2.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 3.2.2 編集操作

**セル編集**:
- [ ] セル内テキスト編集
- [ ] データ型指定（テキスト、数値、日付）
- [ ] フォーマット設定

**構造編集**:
- [ ] 行の追加・削除・移動
- [ ] 列の追加・削除・移動
- [ ] セルの結合・分割
- [ ] 表のリサイズ

**スタイル設定**:
- [ ] 罫線スタイル（太さ、色、種類）
- [ ] セル背景色
- [ ] テキスト配置

**高度な機能**:
- [ ] ソート機能
- [ ] フィルタリング
- [ ] 数式・計算（オプション）

**成功基準**:
- [例: 50行×20列の表を遅延なく編集可能]
- [例: セル編集の応答速度 < 100ms]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- 表エディタライブラリ、Excelライクな機能の範囲など -->

---

### 3.3 図形編集機能

#### 3.3.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 3.3.2 編集操作

**描画ツール**:
- [ ] 矩形
- [ ] 円/楕円
- [ ] 線/矢印
- [ ] 自由描画

**変形操作**:
- [ ] サイズ変更（リサイズハンドル）
- [ ] 回転
- [ ] 反転（水平・垂直）
- [ ] 複製

**スタイル設定**:
- [ ] 線の太さ・色・種類
- [ ] 塗りつぶし色
- [ ] 透明度設定
- [ ] 影・効果

**成功基準**:
- [例: 図形操作の応答速度 < 50ms]
- [例: 100個の図形を遅延なく表示可能]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- 描画ライブラリ（Canvas/SVG）、ベクトル形式の保持など -->

---

### 3.4 共通操作機能

#### 3.4.1 機能概要
**目的**: すべてのオブジェクトに共通する操作体系の提供

#### 3.4.2 基本操作

**選択操作**:
- [ ] 単一選択（クリック）
- [ ] 複数選択（Ctrl+クリック、範囲選択）
- [ ] 全選択（Ctrl+A）
- [ ] 選択解除

**配置操作**:
- [ ] 移動（ドラッグ、矢印キー）
- [ ] グリッドスナップ
- [ ] 整列（左揃え、中央揃え等）
- [ ] 等間隔配置

**削除・復元**:
- [ ] 削除（Delete/Backspace）
- [ ] 復元（Undo: Ctrl+Z）
- [ ] やり直し（Redo: Ctrl+Y）
- [ ] ゴミ箱機能（一時保管）

**クリップボード操作**:
- [ ] コピー（Ctrl+C）
- [ ] カット（Ctrl+X）
- [ ] ペースト（Ctrl+V）
- [ ] 書式を保持したペースト

**レイヤー操作**:
- [ ] 最前面へ移動
- [ ] 最背面へ移動
- [ ] 一つ前面へ
- [ ] 一つ背面へ

**グループ化**:
- [ ] グループ作成（Ctrl+G）
- [ ] グループ解除（Ctrl+Shift+G）
- [ ] グループ内編集

**成功基準**:
- [例: すべての操作でキーボードショートカット対応]
- [例: 操作の応答速度 < 50ms]
- [例: Undo/Redo履歴 50ステップまで保持]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- 操作の一貫性、アクセシビリティ対応など -->

---

## 4. エクスポート機能（Export Functions）

### 4.1 出力フォーマット機能

#### 4.1.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 4.1.2 対応フォーマット

**PDF出力**:
- [ ] レイアウト保持
- [ ] フォント埋め込み
- [ ] 解像度設定（72dpi, 150dpi, 300dpi）
- [ ] PDF/A準拠（オプション）

**Office形式出力**:
- [ ] Word (.docx)
  - テキストと表の再現
  - 画像・図形の埋め込み
- [ ] Excel (.xlsx)
  - 表データの出力
  - 数式の保持（該当する場合）

**軽量フォーマット**:
- [ ] Markdown (.md)
  - テキストと表の変換
  - 画像参照リンク
- [ ] JSON (.json)
  - オブジェクトデータの構造化出力
  - APIアクセス用

**画像出力**:
- [ ] PNG
- [ ] JPEG
- [ ] SVG（ベクトル保持）

**成功基準**:
- [例: レイアウトの再現精度 95%以上]
- [例: 出力処理時間：1ページあたり3秒以内]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- 変換ライブラリの選定、フォーマット間の互換性など -->

---

### 4.2 品質管理機能

#### 4.2.1 機能概要
**目的**: 出力結果の品質を保証

#### 4.2.2 品質設定

**解像度管理**:
- [ ] 低解像度（Web用: 72dpi）
- [ ] 中解像度（標準: 150dpi）
- [ ] 高解像度（印刷用: 300dpi）

**レイアウト保持**:
- [ ] 相対位置の維持
- [ ] サイズ比率の保持
- [ ] ページ境界の処理

**フォント管理**:
- [ ] フォント埋め込み
- [ ] フォールバックフォント設定
- [ ] アウトライン化（オプション）

**プレビュー機能**:
- [ ] エクスポート前プレビュー
- [ ] 差分表示
- [ ] 警告・推奨事項の表示

**成功基準**:
- [例: プレビューと出力結果の一致率 98%以上]
- [例: フォント埋め込みで文字化け 0%]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- 品質保証の自動化、エラーハンドリングなど -->

---

## 5. 協働機能（Collaboration Functions）

### 5.1 共有機能

#### 5.1.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 5.1.2 共有方式

**リンク共有**:
- [ ] 共有リンクの生成
- [ ] 有効期限設定
- [ ] パスワード保護

**権限管理**:
- [ ] 閲覧のみ
- [ ] 編集可能
- [ ] コメント可能
- [ ] 管理者権限

**成功基準**:
- [例: リンク共有が5秒以内に完了]
- [例: 権限の反映が即座に適用]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- セキュリティ考慮、プライバシー保護など -->

---

### 5.2 バージョン管理機能

#### 5.2.1 機能概要
**目的**: [この機能が解決する課題]

**対象ユーザー**: [ペルソナ名]

**ユースケース**: [関連するユースケース]

#### 5.2.2 バージョン管理

**変更履歴**:
- [ ] 自動バージョン保存
- [ ] 手動バージョン作成
- [ ] 変更差分の表示
- [ ] コメント付与

**復元機能**:
- [ ] 過去バージョンへの復元
- [ ] 比較・マージ機能
- [ ] ブランチ管理（高度）

**成功基準**:
- [例: 履歴の保存間隔：5分ごと]
- [例: 30日間の履歴保持]

**優先度**: 🔴 Must-have / 🟡 Should-have / 🟢 Could-have

**実装難易度**: 低 / 中 / 高

**備考**:
<!-- ストレージコスト、履歴の圧縮など -->

---

## 6. MVP機能の定義

### 6.1 機能優先順位マトリックス

#### MoSCoW分析

| 機能 | Must-have | Should-have | Could-have | Won't-have |
|------|-----------|-------------|------------|------------|
| **コア機能** |  |  |  |  |
| ファイルアップロード | ✅ |  |  |  |
| AI/OCR抽出（テキスト・表） | ✅ |  |  |  |
| AI/OCR抽出（図形） |  | ✅ |  |  |
| オブジェクト配置管理 | ✅ |  |  |  |
| **編集機能** |  |  |  |  |
| テキスト基本編集 | ✅ |  |  |  |
| テキストフォーマット |  | ✅ |  |  |
| 表基本編集 | ✅ |  |  |  |
| 表構造編集（行列追加/削除） |  | ✅ |  |  |
| 図形描画・編集 |  | ✅ |  |  |
| 共通操作（選択・移動・削除） | ✅ |  |  |  |
| Undo/Redo | ✅ |  |  |  |
| グループ化・レイヤー管理 |  |  | ✅ |  |
| **エクスポート** |  |  |  |  |
| PDF出力 | ✅ |  |  |  |
| Word/Excel出力 |  | ✅ |  |  |
| Markdown/JSON出力 |  |  | ✅ |  |
| **協働機能** |  |  |  |  |
| リンク共有 |  |  | ✅ |  |
| バージョン管理 |  |  | ✅ |  |

#### 価値 vs コストマトリックス

```
高価値 │ 🟢 ファイルアップロード   │ 🟡 図形編集
      │ 🟢 AI/OCR抽出(テキスト表) │ 🟡 Word/Excel出力
      │ 🟢 オブジェクト配置       │ 🟡 表構造編集
      │ 🟢 基本編集操作          │
─────┼─────────────────────┼─────────────────────
低価値 │ 🟡 Markdown出力         │ 🔴 バージョン管理
      │                         │ 🔴 リアルタイム共有
      └─────────────────────┴─────────────────────
        低コスト                  高コスト
```

### 6.2 MVP機能セット（第1フェーズ）

#### 必須機能（Must-have）
1. **ファイルアップロード**: PDF/画像（PNG, JPG）対応
2. **AI/OCR抽出**: テキストと表の自動認識
3. **オブジェクト配置**: 2Dキャンバス上での視覚的配置
4. **テキスト編集**: 基本的なインライン編集
5. **表編集**: セル内容の編集
6. **共通操作**: 選択、移動、削除、Undo/Redo
7. **PDF出力**: 基本的なエクスポート機能

#### 実装範囲の制約
- 初期対応言語: 日本語・英語
- 最大ファイルサイズ: 10MB
- 最大ページ数: 20ページ
- 同時オブジェクト数: 100個まで

#### 成功基準
- [ ] テキスト抽出精度: 90%以上
- [ ] 表抽出精度: 85%以上
- [ ] 処理速度: 1ページ 5秒以内
- [ ] 編集操作の応答速度: 100ms以内

### 6.3 第2フェーズ以降の拡張機能

#### Should-have機能（第2フェーズ）
1. 図形抽出と編集
2. 高度な表編集（行列追加/削除、結合/分割）
3. テキストフォーマット設定
4. Word/Excel出力
5. グループ化・レイヤー管理

#### Could-have機能（第3フェーズ以降）
1. リアルタイム共有
2. バージョン管理
3. Markdown/JSON出力
4. 高度なAI機能（文脈理解、自動分類）

---

## 7. 技術実現性評価

### 7.1 実装難易度評価

| 機能カテゴリ | 実装難易度 | 必要技術 | リスク要因 |
|------------|----------|---------|----------|
| ファイルアップロード | 低 | Next.js/React, File API | ファイルサイズ制限 |
| AI/OCR抽出 | 高 | Claude Vision API, Tesseract | 精度保証、コスト |
| オブジェクト配置 | 中 | Canvas/SVG, React | パフォーマンス |
| テキスト編集 | 低 | ContentEditable, Draft.js | リッチテキスト対応 |
| 表編集 | 中 | データグリッドライブラリ | 複雑なデータ構造 |
| 図形編集 | 中 | Canvas/SVG, Fabric.js | ベクトル保持 |
| PDF出力 | 中 | jsPDF, PDFKit | レイアウト再現 |
| Office出力 | 高 | Docx.js, ExcelJS | フォーマット互換性 |
| 共有機能 | 中 | Next.js API, 認証 | セキュリティ |
| バージョン管理 | 高 | Git like system | ストレージコスト |

### 7.2 技術スタック推奨

#### フロントエンド
- **フレームワーク**: Next.js 14+ (App Router)
- **UI**: React, TypeScript
- **Canvas/描画**: Fabric.js または Konva.js
- **テキストエディタ**: Draft.js または Slate
- **表エディタ**: AG-Grid または Handsontable

#### バックエンド
- **API**: Next.js API Routes
- **AI/OCR**: Claude Vision API (Anthropic), Tesseract.js
- **ストレージ**: Supabase Storage または AWS S3
- **データベース**: PostgreSQL (Supabase)

#### エクスポート
- **PDF**: jsPDF, PDFKit
- **Office**: Docx.js, ExcelJS
- **Markdown**: Unified.js

### 7.3 リスクと軽減策

| リスク | 影響度 | 発生確率 | 軽減策 |
|--------|--------|---------|--------|
| AI/OCR精度不足 | 高 | 中 | 複数エンジンの組み合わせ、手動補正機能 |
| パフォーマンス低下 | 中 | 中 | 仮想スクロール、遅延ロード |
| フォーマット互換性 | 中 | 高 | プレビュー機能、警告表示 |
| ストレージコスト | 低 | 低 | 圧縮、履歴保持期間制限 |

---

## 8. ステークホルダー承認

### 8.1 レビュー記録

| 日付 | レビュアー | 役割 | ステータス | コメント |
|------|-----------|------|----------|---------|
| YYYY-MM-DD | [名前] | プロダクトマネージャー | - | - |
| YYYY-MM-DD | [名前] | テックリード | - | - |
| YYYY-MM-DD | [名前] | UXデザイナー | - | - |
| YYYY-MM-DD | [名前] | ビジネスオーナー | - | - |

### 8.2 承認基準

- [ ] すべての必須機能（Must-have）が明確に定義されている
- [ ] MVP機能セットが合意されている
- [ ] 技術的実現可能性が検証されている
- [ ] 優先順位付けが完了している
- [ ] 01_visionおよび02_usersとの整合性が取れている

### 8.3 最終承認

**承認者署名**:
- プロダクトマネージャー: ___________________ 日付: _______
- テックリード: ___________________ 日付: _______
- ビジネスオーナー: ___________________ 日付: _______

---

## 9. 次のステップ

### 9.1 完了後のアクション
1. [ ] STATUS.mdを「完了」に更新
2. [ ] PROGRESS_TRACKER.mdに進捗を記録
3. [ ] DECISION_LOG.mdに重要な決定を記録
4. [ ] 04_ux_design/に進む

### 9.2 継続的な更新
- [ ] 週次レビューのスケジュール設定
- [ ] フィードバックループの確立
- [ ] バックログへの機能追加プロセス

---

## 10. 付録

### 10.1 用語集
- **MVP**: Minimum Viable Product（最小実用製品）
- **MoSCoW**: Must/Should/Could/Won't-have（優先順位付け手法）
- **OCR**: Optical Character Recognition（光学文字認識）

### 10.2 参考資料
- [参考ドキュメントやリンク]

---

**テンプレート使用ガイド**:
1. このテンプレートをコピーして`features_v1.md`を作成
2. [ブラケット]内の指示に従って記入
3. チェックボックスで完了状態を管理
4. 不要なセクションは削除可能（理由を記載）
5. 完了後にレビューと承認を取得
